
# תוכנית שיפורים לדאשבורד CellStation

## סיכום הבעיות שזוהו
1. **היעדר אינטגרציה עם מערכת ההשכרות הראשית** - הדאשבורד של CellStation לא מראה מידע על סטטוס ההשכרות מהמערכת הראשית (באיחור/פעיל/מושכר)
2. **חיפוש לא חכם** - החיפוש לא מתמודד עם הבדלי פורמט (מספרים עם/בלי מקפים)
3. **חסר כפתור "מידע נוסף"** - אין אפשרות לראות פרטים מורחבים על השכרה

---

## שינויים מתוכננים

### 1. הוספת סנכרון עם מערכת ההשכרות הראשית

**מה יקרה:**
- בטבלת המלאי (Inventory) ובהשכרות, המערכת תבדוק אם סים מסוים מושכר במערכת הראשית (Supabase)
- אם סים מופיע כ"פנוי" ב-CellStation אבל הוא בעצם מושכר/באיחור במערכת שלכם - יוצג התראה ברורה

**תצוגה:**
- Badge צבעוני: 🔴 "באיחור במערכת" / 🟠 "מושכר במערכת" 
- טקסט עזר: "למי מושכר" + "תאריך החזרה"

---

### 2. כפתור "מידע נוסף" להרחבת פרטי השכרה

**מה יתווסף:**
- כפתור קטן (אייקון ℹ️) בכל שורה בטבלת ההשכרות
- לחיצה תפתח פאנל הרחבה (Collapsible) עם:
  - שם הלקוח המלא
  - מספר טלפון
  - תאריך התחלה וסיום
  - מספר סים (ICCID)
  - סטטוס במערכת הראשית
  - הערות (אם יש)

---

### 3. חיפוש חכם - התעלמות ממקפים

**הבעיה:**
- ב-CellStation המספרים בפורמט: `0722587082` (ללא מקפים)
- במערכת ההשכרות: `07-225-870-82` (עם מקפים)
- חיפוש לא מוצא התאמה

**הפתרון:**
```typescript
// פונקציה לנרמול מספרים לפני השוואה
const normalizeForSearch = (value: string) => {
  return value.replace(/[-\s]/g, '').toLowerCase();
};

// בזמן חיפוש:
const searchNormalized = normalizeForSearch(searchTerm);
const matchesSearch = 
  normalizeForSearch(rental.local_number || '').includes(searchNormalized) ||
  normalizeForSearch(rental.customer_phone || '').includes(searchNormalized);
```

**איפה יחול:**
- טאב השכרות ב-CellStation
- טאב מלאי ב-CellStation
- חיפוש גלובלי (GlobalSearch)

---

## פרטים טכניים

### קבצים שישתנו

| קובץ | שינויים |
|------|----------|
| `src/components/cellstation/CellStationDashboard.tsx` | • הוספת לוגיקת בדיקה מול מערכת ההשכרות<br>• הוספת Badge לסטטוס מערכת ראשית<br>• כפתור "מידע נוסף" עם Collapsible<br>• נרמול חיפוש |
| `src/components/GlobalSearch.tsx` | • נרמול חיפוש למספרים |
| `src/lib/utils.ts` | • הוספת פונקציית `normalizeForSearch` |

### לוגיקת הבדיקה מול מערכת ההשכרות

```text
┌─────────────────────────────────────────────────────────────┐
│  לכל סים בטבלת CellStation:                                 │
│                                                              │
│  1. חפש ב-supabaseInventory לפי simNumber/localNumber        │
│  2. אם נמצא - בדוק סטטוס (available/rented/maintenance)     │
│  3. אם rented - חפש את ההשכרה ב-rentals                     │
│  4. הצג מידע: שם לקוח, תאריך החזרה, האם באיחור              │
└─────────────────────────────────────────────────────────────┘
```

### עיצוב ה-Badge של סטטוס מערכת ראשית

| סטטוס | צבע | טקסט |
|-------|-----|------|
| פנוי (לא במערכת) | אפור | - |
| במלאי ופנוי | ירוק | ✓ זמין |
| מושכר | כחול | 📱 מושכר ל-[שם] |
| באיחור | אדום | ⚠️ באיחור! [שם] |

---

## תוצאה צפויה

1. **שקיפות מלאה** - תראה בדאשבורד CellStation את הסטטוס האמיתי של כל סים במערכת ההשכרות
2. **חיפוש קל** - חפש לפי מספר טלפון בכל פורמט (עם או בלי מקפים)
3. **מידע זמין** - לחיצה אחת לראות כל הפרטים על השכרה
